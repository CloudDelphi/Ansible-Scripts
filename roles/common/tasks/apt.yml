- name: Install various APT tools
  apt: pkg={{ item }}
  with_items:
    - apt
    - apt-listchanges
    - apt-show-versions
    - debian-archive-keyring
    - debian-goodies
    - needrestart
    - unattended-upgrades
    - debfoster
    - deborphan
    - debsecan
    - debsums

- name: Configure APT (1)
  template: src=etc/apt/{{ item }}.j2
            dest=/etc/apt/{{ item }}
            owner=root group=root
            mode=0644
  with_items:
    - sources.list
    - preferences
  notify:
    - apt-get update

- name: Configure APT (2)
  copy: src=etc/apt/{{ item }}
        dest=/etc/apt/{{ item }}
        owner=root group=root
        mode=0644
  with_items:
    - listchanges.conf
    - apt.conf.d/10periodic
    - apt.conf.d/50unattended-upgrades

- name: Configure the Debian Security Analyzer
  template: src=etc/default/debsecan.j2
            dest=/etc/default/debsecan
            owner=root group=root
            mode=0644

- name: Start cron
  service: name=cron state=started
  tags:
    - cron

# We should run 'apt-get update' before proceeding to any other task.
- meta: flush_handlers
