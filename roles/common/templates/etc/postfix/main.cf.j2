########################################################################
# Nullmailer configuration
#
# {{ ansible_managed }}
# Do NOT edit this file directly!

smtpd_banner        = $myhostname ESMTP $mail_name (Debian/GNU)
biff                = no
readme_directory    = no
compatibility_level = 2
smtputf8_enable     = no

myorigin            = /etc/mailname
myhostname          = {{ ansible_fqdn }}
mydomain            = {{ ansible_domain }}
append_dot_mydomain = no

# This server is for internal use only
mynetworks_style = host
inet_interfaces  = loopback-only

# No local delivery
mydestination        =
local_transport      = error:5.1.1 Mailbox unavailable
alias_maps           =
local_recipient_maps =

# All aliases are virtual
default_database_type = lmdb
virtual_alias_maps    = lmdb:/etc/aliases
alias_database        = $virtual_alias_maps

# Forward everything to our internal outgoing proxy
relayhost     = [{{ postfix_instance.out.addr | ipaddr }}]:{{ postfix_instance.out.port }}
relay_domains =

smtp_tls_security_level  = none
smtpd_tls_security_level = none

{% set instances = postfix_instance.keys() | intersect(group_names) | list %}
{%- if instances | length > 0 -%}
# Other postfix instances
multi_instance_wrapper     = $command_directory/postmulti -p --
multi_instance_enable      = yes
multi_instance_directories ={% for i in instances | sort %} /etc/postfix-{{ postfix_instance[i].name }}{% endfor %}
{% endif %}

# vim: set filetype=pfmain :
