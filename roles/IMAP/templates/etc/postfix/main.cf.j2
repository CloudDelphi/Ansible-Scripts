########################################################################
# MDA configuration
#
# {{ ansible_managed }}
# Do NOT edit this file directly!

smtpd_banner     = $myhostname ESMTP $mail_name (Debian/GNU)
biff             = no
readme_directory = no
mail_owner       = postfix

delay_warning_time     = 4h
maximal_queue_lifetime = 5d

myorigin            = /etc/mailname
myhostname          = mda{{ imapno | default('') }}.$mydomain
mydomain            = {{ ansible_domain }}
append_dot_mydomain = no

# Turn off all TCP/IP listener ports except that necessary for the MDA.
master_service_disable = !2526.inet inet

queue_directory       = /var/spool/postfix-{{ postfix_instance[inst].name }}
data_directory        = /var/lib/postfix-{{ postfix_instance[inst].name }}
multi_instance_group  = {{ postfix_instance[inst].group | default('') }}
multi_instance_name   = postfix-{{ postfix_instance[inst].name }}
multi_instance_enable = yes

# This server is a Mail Delivery Agent
mynetworks_style = host
inet_interfaces  = 172.16.0.1
{% if 'MX' in group_names %}
                   127.0.0.1
{% endif %}
inet_protocols   = ipv4

# No local delivery
mydestination        =
local_transport      = error:5.1.1 Mailbox unavailable
alias_maps           =
alias_database       =
local_recipient_maps =

message_size_limit   = 67108864
recipient_delimiter  = +

# No relay: this server is inbound-only
relay_transport   = error:5.1.1 Relay unavailable
default_transport = error:5.1.1 Transport unavailable

# Virtual transport (the alias resolution is already done by the MX:es)
virtual_transport       = lmtp:unix:private/dovecot-lmtpd
virtual_mailbox_domains = ldap:$config_directory/virtual/mailbox_domains.cf
virtual_mailbox_maps    = ldap:$config_directory/virtual/mailbox_maps.cf
mailbox_transport_maps  = ldap:$config_directory/virtual/transport_content_filter_maps.cf

# Don't rewrite remote headers
local_header_rewrite_clients =
# Tolerate occasional high latency
smtpd_timeout                = 1200s
